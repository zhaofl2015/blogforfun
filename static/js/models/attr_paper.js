// Generated by CoffeeScript 1.9.3
(function() {
  var attr_paper;

  attr_paper = (function() {
    function attr_paper() {}

    attr_paper.prototype.papers = ko.observableArray([]);

    attr_paper.prototype._search_paper_id = ko.observable('');

    attr_paper.prototype._search_paper_name = ko.observable('');

    attr_paper.prototype._search_paper_num = ko.observable('');

    attr_paper.prototype._search_paper_list = ko.observableArray([]);

    attr_paper.prototype._search_index_list = ko.observableArray([]);

    attr_paper.prototype.search_paper = function() {
      var that;
      that = this;
      if (this.updateTimer) {
        clearTimeout(this.updateTimer);
        this.updateTimer = null;
      }
      if (this.updateAjax) {
        this.updateAjax.abort();
        this.updateAjax = null;
      }
      this.updateTimer = setTimeout(function() {
        that.updateAjax = $.post('/xx/questions/paper_hints', {
          title: that._search_paper_name(),
          subject_id: that.subject_id()
        }, function(data) {
          var i;
          if (data.success) {
            that._search_paper_list.removeAll();
            for (i in data.hints) {
              if (data.hints.hasOwnProperty(i)) {
                that._search_paper_list.push(new Paper({
                  id: i,
                  content: data.hints[i],
                  number: -1
                }));
                if (data.hints[i] === that._search_paper_name()) {
                  that._search_paper_id(i);
                }
              }
            }
            that.search_paper_numbers();
          }
        });
      });
    };

    attr_paper.prototype.search_paper_numbers = function() {
      var that;
      that = this;
      $.post('/xx/questions/question_index_hints', {
        paper_id: that._search_paper_id
      }, function(data) {
        var d, j, len, ref;
        if (data.success) {
          that._search_index_list.removeAll();
          that._search_index_list.push('请选择');
          ref = data.indices;
          for (j = 0, len = ref.length; j < len; j++) {
            d = ref[j];
            that._search_index_list.push(d);
          }
        }
      });
    };

    attr_paper.prototype.add_paper = function() {
      if ((this._search_paper_id() != null) && this._search_paper_id() !== '') {
        this.papers.push(new Paper({
          id: this._search_paper_id(),
          content: this._search_paper_name(),
          number: this._search_paper_num()
        }));
        this._search_paper_id('');
        this._search_paper_name('');
        this._search_paper_num('');
        this._search_paper_list([]);
        this._search_index_list([]);
      }
    };

    return attr_paper;

  })();

  this.attr_paper = attr_paper;

}).call(this);

//# sourceMappingURL=attr_paper.js.map
