<!-- 题型 -->
{% macro question_type(notChange) %}
<div class="panel panel-info">
    <div class="panel-heading" data-bind="text: nid()==0 ? '题型' : '试题编号：'+nid()"></div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">题型:</label>
            <div class="col-sm-10">
                <p class="form-control-static" data-bind="text: content_type_name"></p>
            </div>

            
            <label class="col-sm-2 control-label">一级题型:</label>
            <!-- ko if: second_content_type_list().length > 0 -->
            <div data-bind="visible: '{{ notChange }}'!='1'" class="col-sm-3">
                <select class="form-control" data-bind="options: second_content_type_list, optionsValue: '0', optionsText: '1', value: second_content_type_id, event: {change: update_third_content_type_list}"></select>
            </div>
            <!-- /ko -->
            <div data-bind="visible: '{{ notChange }}'=='1'" class="col-sm-3">
                <p class="form-control-static" data-bind="text: second_content_type_name"></p>
            </div>
            
            <!-- ko if: third_content_type_list().length > 0 || third_content_type_name -->
            <label class="col-sm-2 control-label">二级题型:</label>
            <!-- /ko -->
            <!-- ko if: third_content_type_list().length > 0 -->
            <div data-bind="visible: '{{ notChange }}'!='1'" class="col-sm-3">
                <select class="form-control" data-bind="options: third_content_type_list, optionsValue: '0', optionsText: '1', value: third_content_type_id"></select>
            </div>
            <!-- /ko -->
            <!-- ko if: third_content_type_name -->
            <div data-bind="visible: '{{ notChange }}'=='1'" class="col-sm-3">
                <p class="form-control-static" data-bind="text: third_content_type_name"></p>
            </div>
            <!-- /ko -->
        </div>
    </div>
</div>
{% endmacro %}

<!-- 所属试卷 -->
{% macro choose_paper() %}
<div class="panel panel-info">
    <div class="panel-heading">所属试卷/教辅</div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">所属试卷：</label>
            <div class="col-sm-10">
                <div class="form-group" data-bind="if: papers().length > 0, visible: papers().length > 0">
                    <table class="table table-striped table-bordered table-condensed">
                        <thade>
                            <tr>
                                <td>试卷名称</td>
                                <td>题号</td>
                                <td>操作</td>
                            </tr>
                        </thade>
                        <tbody data-bind="foreach: papers">
                            <tr>
                                <td data-bind="text: content"></td>
                                <td data-bind="text: number"></td>
                                <td class="col-sm-3">
                                    <a target="_blank" data-bind="attr: { href: '/xx/papers/paper-manage-questions?paper_id=' + id() }">查看试卷</a>
                                    <a href="javascript:void(0);" data-bind="click: function(){ $parent.papers.remove(this); }">删除</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="form-group">
                    <div class="col-sm-5">
                        <input class="form-control" list="__choose_papers" data-bind="value: _search_paper_name, event: { input: search_paper }, valueUpdate: 'input'" placeholder="请输入试卷名称">
                        <datalist id="__choose_papers" data-bind="foreach: _search_paper_list">
                            <option data-bind="attr: { value: content }"></option>
                        </datalist>
                    </div>
                    <label class="col-sm-2 control-label">题号：</label>
                    <div class="col-sm-3">
                        <select data-bind="foreach: _search_index_list, value: _search_paper_num" class="form-control">
                            <option data-bind="attr: { value : $data }, text: $data"></option>
                        </select>
                    </div>
                    <div class="col-xs-2">
                        <button data-bind="click : add_paper" class="btn btn-primary">确定</button>
                    </div>
                </div>
            </div>
        </div>

        <!--教辅-->
        <div class="form-group">
            <label class="col-sm-2 control-label">所属教辅：</label>
            <div class="col-sm-10">
                <div class="form-group" data-bind="if: workbook_contents().length > 0, visible: workbook_contents().length > 0">
                    <table class="table table-striped table-bordered table-condensed">
                        <thade>
                            <tr>
                                <td>教辅名称</td>
                                <td>题号</td>
                                <!-- ko if: '{{ g.subject_id }}'=='103' -->
                                <td>题号voicetext</td>
                                <!-- /ko -->
                                <td>操作</td>
                            </tr>
                        </thade>
                        <tbody data-bind="foreach: workbook_contents">
                            <tr>
                                <td>
                                    <a tabindex="0" href="javascript:void(0);" data-bind="text: name, attr: {'data-content': typeof detail=='undefined' ? '' : detail}" role="button" data-toggle="popover" data-trigger="focus" class="popinfo"></a>
                                </td>
                                <td data-bind="text: number"></td>
                                <!-- ko if: '{{ g.subject_id }}'=='103' -->
                                <td data-bind="text: number_voice_text"></td>
                                <!-- /ko -->
                                <td class="col-sm-3">
                                    <a target="_blank" data-bind="attr: { href: '/workbook/content-manage?workbook_catalog_id=' + id }">查看教辅</a>
                                    <a href="javascript:void(0);" data-bind="click: function(){ $parent.workbook_contents.remove(this); }">删除</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="form-group">
                    <div class="col-sm-3">
                        <input class="form-control" data-bind="value: search_workbook_content_name, click: search_workbook_content, valueUpdate: 'input'" placeholder="请选择教辅" readonly style="background-color:#FFF;">
                    </div>
                    <label class="pull-left form-control-static">题号：</label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" data-bind="value: search_num">
                    </div>
                    <!-- ko if: '{{ g.subject_id }}'=='103' -->
                    <label class="pull-left form-control-static">题号voicetext：</label>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" data-bind="value: number_voice_text">
                    </div>
                    <!-- /ko -->
                    <div class="pull-left">
                        <button data-bind="click : add_workbook_content" class="btn btn-primary">确定</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}


<!-- 重题列表页弹框中的所属试卷 -->
{% macro choose_paper_resource() %}

<div class="form-group">
    <label class="col-sm-2 control-label form-control-static">所属试卷:</label>
    <div class="col-sm-10">
        <div class="form-group" data-bind="if: papers().length > 0, visible: papers().length > 0">
            <table class="table table-striped table-bordered table-condensed">
                <thade>
                    <tr>
                        <td>试卷名称</td>
                        <td>题号</td>
                        <td>操作</td>
                    </tr>
                </thade>
                <tbody data-bind="foreach: papers">
                    <tr>
                        <td data-bind="text: content"></td>
                        <td data-bind="text: number"></td>
                        <td class="col-sm-3">
                            <a target="_blank" data-bind="attr: { href: '/xx/papers/paper-manage-questions?paper_id=' + id() }">查看试卷</a>
                            <a href="javascript:void(0);" data-bind="click: function(){ $parent.papers.remove(this); }">删除</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="row">
            <div class="col-sm-5">
                <input class="form-control" list="__choose_papers" data-bind="value: _search_paper_name, event: { input: search_paper }, valueUpdate: 'input'" placeholder="请输入试卷名称">
                <datalist id="__choose_papers" data-bind="foreach: _search_paper_list">
                    <option data-bind="attr: { value: content }"></option>
                </datalist>
            </div>
            <label class="col-sm-2 control-label form-control-static text-right">题号：</label>
            <div class="col-sm-3">
                <select data-bind="foreach: _search_index_list, value: _search_paper_num" class="form-control">
                    <option data-bind="attr: { value : $data }, text: $data"></option>
                </select>
            </div>
            <div class="col-xs-2">
                <button data-bind="click : add_paper" class="btn btn-primary">添加</button>
            </div>
        </div>
    </div>
</div>

{% endmacro %}

<!-- 题目知识点 -->
{% macro points() %}
<div class="panel panel-info">
    <div class="panel-heading">题目知识点</div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">题目知识点:</label>
            <div class="col-sm-10">
                <div class="form-group" data-bind="if: points().length > 0, visible: points().length > 0">
                    <table class="table table-striped table-bordered table-condensed">
                        <thade>
                            <tr>
                                <td>知识点名称</td>
                                <td>知识点类型</td>
                                <td>操作</td>
                            </tr>
                        </thade>
                        <tbody data-bind="foreach: points">
                            <tr>
                                <td data-bind="text: content"></td>
                                <td>
                                    <label class="control-label">
                                        <input type="checkbox" data-bind="checked: isKeyPoint">
                                        主知识点
                                    </label>
                                </td>
                                <td class="col-sm-3">
                                    <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                                </th>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="form-group">
                    <div class="col-sm-7">
                        <input type="text" class="treeDialog form-control">
                    </div>
                    <div class="col-sm-3">
                        <label class="radio-inline">
                            <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                            设为主知识点
                        </label>
                    </div>
                    <div class="col-sm-2">
                        <button class="btn btn-primary" data-bind="click: add_point">新增考点</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- 难度 -->
{% macro difficulty() %}
<div class="panel panel-info">
    <div class="panel-heading">题目难度</div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">难度值:</label>
            <div class="col-sm-2">
                <select class="form-control" data-bind="options: difficulty_list, optionsValue: '0', optionsText: '1', value: difficulty_id, event: { change: difficulty_update }"></select>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- 前端是否显示 -->
{% macro needShow() %}
<div class="panel panel-info">
    <div class="panel-heading">显示属性</div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">前端是否显示</label>
            <div class="col-sm-3">
                <label class="radio-inline">
                    <input type="radio" name="inlineRadioOptions" data-bind="value: 0, checked: question_type" /> 不显示
                </label>
                <label class="radio-inline">
                    <input type="radio" name="inlineRadioOptions" data-bind="value: 1, checked: question_type" /> 显示
                </label>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- 作答时间 -->
{% macro answer_time() %}
<div class="panel panel-info">
    <div class="panel-heading">作答时间</div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">作答时间:</label>
            <div class="col-sm-3">
                <div class="input-group">
                    <input type="text" data-bind="value: seconds, valueUpdate: 'afterkeydown'" class="form-control" placeholder="请输入作答时间">
                    <div class="input-group-addon">秒</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- 听力材料 -->
{% macro litens() %}
<div class="panel panel-info" data-bind="visible: has_listen">
    <div class="panel-heading">听力材料</div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">听力材料:</label>
            <div class="col-sm-10">
                <div class="form-group">
                    <div class="files" data-bind="if: resources().length > 0, visible: resources().length > 0">
                        <div class="panel panel-default">
                            <table class="table">
                                <tbody data-bind="foreach: resources">
                                    <tr>
                                        <td data-bind="text: name"></td>
                                        <td style="width: 50px;">
                                            <audio preload="none" data-bind="attr: { src: url }" controls></audio>
                                        </td>
                                        <td style="width: 50px;">
                                            <a class="glyphicon glyphicon-remove" data-bind="click: function(){ $parent.resources.remove(this); }"></a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <span class="btn btn-success fileinput-button">
                        <i class="glyphicon glyphicon-plus"></i>
                        <span>上传音频</span>
                        <input id="fileupload" type="file" name="files[]" multiple>
                    </span>
                </div>
                <div class="form-group">
                    <div id="progress" class="progress">
                        <div class="progress-bar progress-bar-success"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- 作答说明 -->
{% macro description() %}
<div class="panel panel-info">
    <div class="panel-heading">作答说明</div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-sm-2 control-label">作答说明:</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" data-bind="value: description">
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!-- 题干 -->
{% macro content(content_type) %}
<div class="panel panel-info">
    <div class="panel-heading">题目信息</div>
    <div class="panel-body question_content">
        <div class="form-group">
            <label class="col-sm-2 control-label">题干:</label>
            <div class="col-sm-10">
                <script data-bind="attr: { id: content_editor_code }" name="content_editor_code" type="text/plain"></script>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-10 col-sm-offset-2">
                {{check_repeat(content_type)}}  
            </div>
            
        </div>
        
{% endmacro %}

<!-- 口语题干 -->
{% macro oral_content() %}
<div class="panel panel-info">
    <div class="panel-heading">题目信息</div>
    <div class="panel-body question_content">
        <div class="form-group">
            <label class="col-sm-2 control-label">题干:</label>
            <div class="col-sm-10">
                <div class="form-group">
                    <div class="files" data-bind="if: pic_url().length > 0, visible: pic_url().length > 0">
                        <div class="panel panel-default">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td data-bind="text: pic_name"></td>
                                        <td style="width: 50px;">
                                            <img data-bind="attr: { src: pic_url }" style="max-width: 300px; max-height: 300px;" />
                                        </td>
                                        <td style="width: 50px;">
                                            <a class="glyphicon glyphicon-remove" data-bind="click: function(){ pic_url(''); pic_name('') }"></a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <span class="btn btn-success fileinput-button">
                        <i class="glyphicon glyphicon-plus"></i>
                        <span>图片上传</span>
                        <input id="imgupload" type="file" name="files[]" multiple>
                    </span>
                </div>
                <div class="form-group">
                    <div id="imgprogress" class="progress">
                        <div class="progress-bar progress-bar-success"></div>
                    </div>
                </div>
            </div>
            <label class="col-sm-2 control-label"></label>
            <div class="col-sm-10">
                <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
            </div>
        </div>
{% endmacro %}


{% macro oral_attrs() %}
<!-- ko if: variables().length == 0 -->
<div class="form-group">
    <label class="col-sm-2 control-label">变量:</label>
</div>
<!-- /ko -->
<!-- ko foreach: variables -->
<div class="form-group">
    <label class="col-sm-2 control-label" data-bind="text: $index() == 0 ? '变量:' : ''"></label>
    <div class="col-sm-1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: function(){ $parent.variables.remove($data); }"></button></div>
    <div class="col-sm-9">
        <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
    </div>
</div>
<!-- /ko -->
<div class="form-group">
    <label class="col-sm-2 control-label"></label>
    <div class="col-sm-10">
        <button data-bind="click: function(){ variables.push(new Variable('')); }" class="btn btn-primary">增加变量</button>
    </div>
</div>

<!-- ko if: sentence_patterns().length == 0 -->
<div class="form-group">
    <label class="col-sm-2 control-label">句式:</label>
</div>
<!-- /ko -->
<!-- ko foreach: sentence_patterns -->
<div class="form-group">
    <label class="col-sm-2 control-label" data-bind="text: $index() == 0 ? '句式:' : ''"></label>
    <div class="col-sm-1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: function(){ $parent.sentence_patterns.remove($data); }"></button></div>
    <div class="col-sm-9">
        <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
    </div>
</div>
<!-- /ko -->
<div class="form-group">
    <label class="col-sm-2 control-label"></label>
    <div class="col-sm-10">
        <button data-bind="click: function(){ sentence_patterns.push(new SentencePattern('')); }" class="btn btn-primary">增加句式</button>
    </div>
</div>

<!-- ko if: keywords().length == 0 -->
<div class="form-group">
    <label class="col-sm-2 control-label">关键字:</label>
</div>
<!-- /ko -->
<!-- ko foreach: keywords -->
<div class="form-group">
    <label class="col-sm-2 control-label" data-bind="text: $index() == 0 ? '关键字:' : ''"></label>
    <div class="col-sm-1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: function(){ $parent.keywords.remove($data); }"></button></div>
    <div class="col-sm-9">
        <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
    </div>
</div>
<!-- /ko -->
<div class="form-group">
    <label class="col-sm-2 control-label"></label>
    <div class="col-sm-10">
        <button data-bind="click: function(){ keywords.push(new Keyword('')); }" class="btn btn-primary">增加关键字</button>
    </div>
</div>
{% endmacro %}


<!--选择题、归类题、排序题、判断题、选词填空 选项-->
{% macro choice(content_type) %}
<div class="form-group">
    <label class="col-sm-2 control-label">选项:</label>
    <div class="col-sm-10">
        <div class="form-group">
            <div class="checkbox">
                <label class="control-label" for="__hide_option_number">
                    <input type="checkbox" id="__hide_option_number" data-bind="checked: hide_option_number">
                    不显示选项序号
                </label>
            </div>
        </div>
        <!-- ko foreach: options -->
        <div class="optionitem">
            <div class="form-group">
                <!-- ko switch: '{{content_type}}' -->
                    <!-- ko case: 8 -->
                    <label class="col-sm-1 control-label" data-bind="text: id()+1, visible: !$parent.hide_option_number()"></label>
                    <!-- /ko -->
                    <!-- ko case: 9 -->
                    <label class="col-sm-1 control-label" data-bind="text: id()+1, visible: !$parent.hide_option_number()"></label>
                    <!-- /ko -->
                    <!-- ko case: $default -->
                    <label class="col-sm-1 control-label" data-bind="text: id, visible: !$parent.hide_option_number()"></label>
                    <!-- /ko -->
                <!-- /ko -->
                <div class="col-sm-1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: $parent.delete_option.bind($data, $parent)"></button></div>
                <!-- ko switch: '{{content_type}}' -->
                    <!-- ko case: 11 -->
                    <div class="col-sm-10">
                        <div class="panel panel-info">
                            <div class="panel-body question_content">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">显示内容:</label>
                                    <div class="col-sm-9">
                                        <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
                                    </div>
                                </div>
                                <!-- ko foreach: voice_texts -->
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Voice text:</label>
                                    <div class="col-sm-1" data-bind="if: $parent.voice_texts().length > 1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: function(){ $parent.voice_texts.remove($data); }"></button></div>
                                    <div class="col-sm-9" data-bind="css: { 'col-sm-8': $parent.voice_texts().length > 1 }">
                                        <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
                                    </div>
                                </div>
                                <!-- /ko -->
                                <button data-bind="click: function(){ voice_texts.push(new Voice('')); }" class="btn btn-primary">增加 Voice text</button>
                            </div>
                        </div>
                    </div>
                    <!-- /ko -->
                    <!-- ko case: $default -->
                    <div class="col-sm-10">
                        <script data-bind="attr: { id: _editor_code }" name="optioncontent" type="text/plain"></script>
                    </div>
                    <!-- /ko -->
                <!-- /ko -->
            </div>
        </div>
        <!-- /ko -->
        <!-- ko switch: '{{content_type}}' -->
            <!-- ko case: 8 -->
            <button data-bind="click : add_option.bind($data, 1)" class="btn btn-primary">增加选项</button>
            <!-- /ko -->
            <!-- ko case: 9 -->
            <button data-bind="click : add_option.bind($data, 1)" class="btn btn-primary">增加选项</button>
            <!-- /ko -->
            <!-- ko case: 11 -->
            <button data-bind="click : add_option.bind($data, 0, 11)" class="btn btn-primary">增加选项</button>
            <!-- /ko -->
            <!-- ko case: $default -->
            <button data-bind="click : add_option" class="btn btn-primary">增加选项</button>
            <!-- /ko -->
        <!-- /ko -->
    </div>
</div>
{% endmacro %}

<!--连线题 选项-->
{% macro line_choice() %}
<div class="form-group">
    <label class="col-sm-2 control-label">选项:</label>
    <div class="col-sm-10">
        <div class="form-group">
            <div class="checkbox">
                <label class="control-label" for="__hide_option_number">
                    <input type="checkbox" id="__hide_option_number" data-bind="checked: hide_option_number">
                    不显示选项序号
                </label>
            </div>
        </div>
        <!-- ko foreach: options -->
        <div class="optionitem">
            <div class="form-group">
                <label class="col-sm-1 control-label" data-bind="text: id()+1, visible: !$parent.hide_option_number()"></label>
                <div class="col-sm-1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: $parent.delete_option.bind($data, $parent)"></button></div>
                <div class="col-sm-10">
                    <script data-bind="attr: { id: _editor_code }" name="optioncontent" type="text/plain"></script>
                </div>
                <div class="margin-top pull-left">
                    <div class="col-sm-2"></div>
                    <label class="control-label col-sm-2 form_option_text">位置：</label>
                    <div class="pull-left form_option_text">第</div>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" data-bind="value: position_col">
                    </div>
                    <div class="pull-left form_option_text">列</div>
                    <div class="col-sm-1"></div>
                    <div class="pull-left form_option_text">第</div>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" data-bind="value: position_index">
                    </div>
                    <div class="pull-left form_option_text">个</div>
                </div>
            </div>
        </div>
        <!-- /ko -->
        <button data-bind="click : add_option.bind($data, 1)" class="btn btn-primary">增加选项</button>
    </div>
</div>
{% endmacro %}


<!-- 口语朗读 选项 -->
{% macro aloud_choice() %}
<div class="form-group">
    <label class="col-sm-2 control-label">Voice text:</label>
    <div class="col-sm-10">
        <textarea class="form-control" rows="5" data-bind="value: voice_text, valueUpdate: 'afterkeydown'"></textarea>
    </div>
</div>
{% endmacro %}


<!-- 角色题 选项 -->
{% macro rol_choice(type) %}
<div class="form-group">
    <label class="col-sm-2 control-label" data-bind="text: '{{ type }}' == 'single' ? '跟读内容:' : '选项:'"></label>
    <div class="col-sm-10">
        <!-- ko foreach: roles -->
        <div class="optionitem">
            <div class="form-group">
                <div class="col-sm-1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: $parent.delete_role.bind($data, $parent)"></button></div>
                <div class="col-sm-10">
                    <div class="panel panel-info">
                        <div class="panel-body question_content">
                            <!-- ko ifnot: '{{ type }}' == 'single' -->
                            <div>
                                <ul class="nav nav-tabs" role="tablist">
                                    <li role="presentation" data-bind="css: { 'active': role_type() == 1 }, click: $parent.change_role_type.bind($data, 1)"><a data-bind="attr: { href: '#role' + $index(), 'aria-controls': 'role' + $index() }" role="tab" data-toggle="tab">作答角色</a></li>
                                    <li role="presentation" data-bind="css: { 'active': role_type() == 2 }, click: $parent.change_role_type.bind($data, 2)"><a data-bind="attr: { href: '#npc' + $index(), 'aria-controls': 'npc' + $index() }" role="tab" data-toggle="tab">非作答角色</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div role="tabpanel" class="tab-pane" data-bind="css: { 'active': role_type() == 1 }, attr: { id: 'role' + $index() }">
                                        <div class="form-group"></div>
                                        <div class="form-group"></div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">角色名称:</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" rows="5" data-bind="value: name, valueUpdate: 'afterkeydown'" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">显示内容:</label>
                                            <div class="col-sm-9">
                                                <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
                                            </div>
                                        </div>
                                        <!-- ko foreach: voice_texts -->
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">Voice text:</label>
                                            <div class="col-sm-1" data-bind="if: $parent.voice_texts().length > 1"><button class="btn btn-primary glyphicon glyphicon-trash" data-bind="click: function(){ $parent.voice_texts.remove($data); }"></button></div>
                                            <div class="col-sm-9" data-bind="css: { 'col-sm-8': $parent.voice_texts().length > 1 }">
                                                <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label"></label>
                                            <div class="col-sm-9">
                                                <button data-bind="click: function(){ voice_texts.push(new Voice('')); }" class="btn btn-primary">增加 Voice text</button>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">作答时间:</label>
                                            <div class="col-sm-5">
                                                <div class="input-group">
                                                    <input type="text" data-bind="value: seconds, valueUpdate: 'afterkeydown'" class="form-control" placeholder="请输入作答时间">
                                                    <div class="input-group-addon">秒</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div role="tabpanel" class="tab-pane" data-bind="css: { 'active': role_type() == 2 }, attr: { id: 'npc' + $index() }">
                                        <div class="form-group"></div>
                                        <div class="form-group"></div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">角色名称:</label>
                                            <div class="col-sm-9">
                                                <input class="form-control" rows="5" data-bind="value: name, valueUpdate: 'afterkeydown'" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-3 control-label">显示内容:</label>
                                            <div class="col-sm-9">
                                                <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <div class="files col-sm-12" data-bind="if: resource.url().length > 0, visible: resource.url().length > 0">
                                                <div class="panel panel-default">
                                                    <table class="table">
                                                        <tbody>
                                                            <tr>
                                                                <td data-bind="text: resource.name"></td>
                                                                <td style="width: 50px;">
                                                                    <audio preload="none" data-bind="attr: { src: resource.url }" controls></audio>
                                                                </td>
                                                                <td style="width: 50px;">
                                                                    <a class="glyphicon glyphicon-remove" data-bind="click: delete_resource"></a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <label class="col-sm-1 control-label">&nbsp;</label>
                                            <span class="btn btn-success fileinput-button">
                                                <i class="glyphicon glyphicon-plus"></i>
                                                <span>上传音频</span>
                                                <input data-bind="attr: { id: 'fileupload_role_' + $index(), 'data-role-index': $index() }" class="roles_upload" type="file" name="files[]" multiple>
                                            </span>
                                        </div>
                                        <div class="form-group">
                                            <div data-bind="attr: { id: 'progress_role_' + $index() }" class="progress">
                                                <div class="progress-bar progress-bar-success"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /ko -->
                            <!-- ko if: '{{ type }}' == 'single' -->
                            <div class="form-group">
                                <label class="col-sm-3 control-label">显示内容:</label>
                                <div class="col-sm-9">
                                    <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'afterkeydown'"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">voice text:</label>
                                <div class="col-sm-9">
                                    <textarea class="form-control" rows="5" data-bind="value: voice_text, valueUpdate: 'afterkeydown'"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">作答时间:</label>
                                <div class="col-sm-5">
                                    <div class="input-group">
                                        <input type="text" data-bind="value: seconds, valueUpdate: 'afterkeydown'" class="form-control" placeholder="请输入作答时间">
                                        <div class="input-group-addon">秒</div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="files col-sm-12" data-bind="if: resource.url().length > 0, visible: resource.url().length > 0">
                                    <div class="panel panel-default">
                                        <table class="table">
                                            <tbody>
                                                <tr>
                                                    <td data-bind="text: resource.name"></td>
                                                    <td style="width: 50px;">
                                                        <audio preload="none" data-bind="attr: { src: resource.url }" controls></audio>
                                                    </td>
                                                    <td style="width: 50px;">
                                                        <a class="glyphicon glyphicon-remove" data-bind="click: delete_resource"></a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <label class="col-sm-1 control-label">&nbsp;</label>
                                <span class="btn btn-success fileinput-button">
                                    <i class="glyphicon glyphicon-plus"></i>
                                    <span>上传音频</span>
                                    <input data-bind="attr: { id: 'fileupload_role_' + $index(), 'data-role-index': $index() }" class="roles_upload" type="file" name="files[]" multiple>
                                </span>
                            </div>
                            <div class="form-group">
                                <div data-bind="attr: { id: 'progress_role_' + $index() }" class="progress">
                                    <div class="progress-bar progress-bar-success"></div>
                                </div>
                            </div>
                            <!-- /ko -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /ko -->
        <!-- ko ifnot: '{{ type }}' == 'single' -->
        <button data-bind="click: add_role" class="btn btn-primary">增加角色</button>
        <!-- /ko -->
        <!-- ko if: '{{ type }}' == 'single' -->
        <button data-bind="click: add_role" class="btn btn-primary">增加</button>
        <!-- /ko -->
    </div>
</div>
{% endmacro %}


<!-- 选择题、判断题答案 -->
{% macro choice_answer() %}
<div class="form-group">
    <label class="col-sm-2 control-label">正确答案: </label>
    <!-- ko if: answer_is_radio() -->
    <div class="col-sm-10 answer_nlgs" data-bind="foreach: options">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="col-sm-12 form-group">
                    <label class="radio-inline col-sm-2">
                        <input type="radio" name="rightanswer" data-bind="value: id(), checked: $parent._answer_list, click: function(){ TreeDialogMod.bindInput($('.treeDialog')); return true; }">
                        <!-- ko text: id --><!-- /ko -->
                    </label>
                </div>
            </div>
            <div class="form-group" data-bind="if: $.inArray(id(), $parent._answer_list()) != -1, visible: $.inArray(id(), $parent._answer_list()) != -1">
                <label class="col-sm-2 control-label">知识点:</label>
                <div class="col-sm-8">
                    <div class="form-group" data-bind="if: points().length > 0, visible: points().length > 0">
                        <table class="table table-striped table-bordered table-condensed">
                            <thade>
                                <tr>
                                    <td>知识点名称</td>
                                    <td>知识点类型</td>
                                    <td>操作</td>
                                </tr>
                            </thade>
                            <tbody data-bind="foreach: points">
                                <tr>
                                    <td data-bind="text: content"></td>
                                    <td>
                                        <label class="control-label">
                                            <input type="checkbox" data-bind="checked: isKeyPoint">
                                            主知识点
                                        </label>
                                    </td>
                                    <td class="col-sm-3">
                                        <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-sm-5">
                            <input type="text" class="treeDialog form-control">
                        </div>
                        <div class="col-sm-5">
                            <label class="radio-inline">
                                <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                                设为主知识点
                            </label>
                        </div>
                        <div class="col-sm-2">
                            <button class="btn btn-primary" data-bind="click: add_option_point">新增考点</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group" data-bind="if: $.inArray(id(), $parent._answer_list()) != -1, visible: $.inArray(id(), $parent._answer_list()) != -1">
                <label class="col-sm-2 control-label">分值:</label>
                <div class="col-sm-8">
                    <input class="form-control" data-bind="value: score" placeholder="请输入分值系数（整数）">
                </div>
            </div>
        </div>
    </div>
    <!-- /ko -->
    <!-- ko ifnot: answer_is_radio() -->
    <div class="col-sm-10 answer_nlgs" data-bind="foreach: options">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="col-sm-12 form-group">
                    <label class="radio-inline col-sm-2">
                        <input type="checkbox" name="rightanswer" data-bind="value: id(), checked: $parent._answer_list, click: function(){ TreeDialogMod.bindInput($('.treeDialog')); return true; }">
                        <!-- ko text: id --><!-- /ko -->
                    </label>
                </div>
            </div>
            <div class="form-group" data-bind="if: $.inArray(id(), $parent._answer_list()) != -1, visible: $.inArray(id(), $parent._answer_list()) != -1">
                <label class="col-sm-2 control-label">知识点:</label>
                <div class="col-sm-8">
                    <div class="form-group" data-bind="if: points().length > 0, visible: points().length > 0">
                        <table class="table table-striped table-bordered table-condensed">
                            <thade>
                                <tr>
                                    <td>知识点名称</td>
                                    <td>知识点类型</td>
                                    <td>操作</td>
                                </tr>
                            </thade>
                            <tbody data-bind="foreach: points">
                                <tr>
                                    <td data-bind="text: content"></td>
                                    <td>
                                        <label class="control-label">
                                            <input type="checkbox" data-bind="checked: isKeyPoint">
                                            主知识点
                                        </label>
                                    </td>
                                    <td class="col-sm-3">
                                        <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-sm-5">
                            <input type="text" class="treeDialog form-control">
                        </div>
                        <div class="col-sm-5">
                            <label class="radio-inline">
                                <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                                设为主知识点
                            </label>
                        </div>
                        <div class="col-sm-2">
                            <button class="btn btn-primary" data-bind="click: add_option_point">新增考点</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group" data-bind="if: $.inArray(id(), $parent._answer_list()) != -1, visible: $.inArray(id(), $parent._answer_list()) != -1">
                <label class="col-sm-2 control-label">分值:</label>
                <div class="col-sm-8">
                    <input class="form-control" data-bind="value: score" placeholder="请输入分值系数（整数）">
                </div>
            </div>
        </div>
    </div>
    <!-- /ko -->
</div>
{% endmacro %}

<!--填空题答案-->
{% macro block_answer() %}
<div class="form-group">
    <label class="col-sm-2 control-label">正确答案: </label>
    <!-- ko if: answers().length == 0 -->
    <div class="col-sm-10" style="font: 16px/20px sans-serif;">请在题干输入内容，填空部分用 __$$__  标示</div>
    <!-- /ko -->
    <div class="col-sm-10 answer_nlgs" data-bind="foreach: answers">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="col-sm-12 form-group">
                    <label class="col-sm-2" data-bind="text: '第 ' + ($index() + 1) + ' 空'"></label>
                    <label data-bind="if: '{{ g.subject_id }}' >= 200, visible: '{{ g.subject_id }}' >= 200">
                        <input type="checkbox" data-bind="checked: editor_type()==1, event: { change: function(){ editor_type(Math.abs(editor_type()-1)) } }">
                        使用富文本
                    </label>
                </div>
                <div class="col-sm-12" data-bind="visible: editor_type() == 1">
                    <script data-bind="attr: { id: _editor_code }" name="blockanswer_content" type="text/plain"></script>
                </div>
                <div class="col-sm-12" data-bind="visible: editor_type() == 0">
                    <textarea class="form-control" rows="5" data-bind="value: content, valueUpdate: 'keypress'"></textarea>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">知识点:</label>
                <div class="col-sm-8">
                    <div class="form-group" data-bind="if: points().length > 0, visible: points().length > 0">
                        <table class="table table-striped table-bordered table-condensed">
                            <thade>
                                <tr>
                                    <td>知识点名称</td>
                                    <td>知识点类型</td>
                                    <td>操作</td>
                                </tr>
                            </thade>
                            <tbody data-bind="foreach: points">
                                <tr>
                                    <td data-bind="text: content"></td>
                                    <td>
                                        <label class="control-label">
                                            <input type="checkbox" data-bind="checked: isKeyPoint">
                                            主知识点
                                        </label>
                                    </td>
                                    <td class="col-sm-3">
                                        <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-5">
                            <input type="text" class="treeDialog form-control">
                        </div>
                        <div class="col-sm-5">
                            <label class="radio-inline">
                                <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                                设为主知识点
                            </label>
                        </div>
                        <div class="col-sm-2">
                            <button class="btn btn-primary" data-bind="click: add_option_point">新增考点</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">分值:</label>
                <div class="col-sm-8">
                    <input class="form-control" data-bind="value: score" placeholder="请输入分值系数（整数）">
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!--归类题、连线题答案-->
{% macro classify_line_answer(content_type) %}
<div class="form-group">
    <label class="col-sm-2 control-label">正确答案: </label>
    <div class="col-sm-10">
        <div data-bind="foreach: answers">
            <div class="panel panel-default">
                <div class="panel-heading">
                    第<span data-bind="text: id()+1"></span>组
                    <span data-bind="text: {{content_type}}==8 ? '归类' : '连线'"></span>
                    <a href="#" class="pull-right" data-bind="click: $parent.delete_answer.bind($data, $parent)">删除</a>
                </div>
                <div class="panel-body">
                    <!-- ko if: '{{content_type}}'==8 -->
                    <div class="form-group">
                        <label class="col-sm-2 control-label">名称：</label>
                        <div class="col-sm-8">
                            <input data-bind="value: classify_name" type="text" class="form-control" data-bind="value: content" placeholder="填写归类组的名称">  
                        </div>  
                    </div>
                    <!-- /ko -->

                    <div class="form-group">
                        <label class="col-sm-2 control-label">答案：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" data-bind="value: content" placeholder="请输入选项的编号，用英文逗号隔开">  
                        </div>  
                    </div>
                    
                    <div class="form-group">
                        <label class="col-sm-2 control-label">知识点：</label>
                        <div class="col-sm-8">
                            <div class="form-group" data-bind="if: points().length > 0, visible: points().length > 0">
                                <table class="table table-striped table-bordered table-condensed">
                                    <thade>
                                        <tr>
                                            <td>知识点名称</td>
                                            <td>知识点类型</td>
                                            <td>操作</td>
                                        </tr>
                                    </thade>
                                    <tbody data-bind="foreach: points">
                                        <tr>
                                            <td data-bind="text: content"></td>
                                            <td>
                                                <label class="control-label">
                                                    <input type="checkbox" data-bind="checked: isKeyPoint">
                                                    主知识点
                                                </label>
                                            </td>
                                            <td class="col-sm-3">
                                                <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                                            </th>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="row">
                                <div class="col-sm-5">
                                    <input type="text" class="treeDialog form-control">
                                </div>
                                <div class="col-sm-5">
                                    <label class="radio-inline">
                                        <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                                        设为主知识点
                                    </label>
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-primary" data-bind="click: add_option_point">新增考点</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">分值:</label>
                        <div class="col-sm-8">
                            <input class="form-control" data-bind="value: score" placeholder="请输入分值系数（整数）">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <a href="#" class="btn btn-primary" data-bind="click: add_answer, text: {{content_type}}==8 ? '增加归类组' : '增加连线组'"></a>
    </div>
</div>
{% endmacro %}

<!--排序答案-->
{% macro sort_answer() %}
<div class="form-group">
    <label class="col-sm-2 control-label">正确答案: </label>
    <div class="col-sm-10">
        <div data-bind="foreach: answers">
            <div class="panel panel-default">
                <div class="panel-heading">
                    （按照正确顺序填写选项的编号，如：2,3,1）
                </div>
                <div class="panel-body">

                    <div class="form-group">
                        <label class="col-sm-2 control-label">答案：</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" data-bind="value: content" placeholder="请输入选项的编号，用英文逗号隔开">  
                        </div>  
                    </div>
                    
                    <div class="form-group">
                        <label class="col-sm-2 control-label">知识点：</label>
                        <div class="col-sm-8">
                            <div class="form-group" data-bind="if: points().length > 0, visible: points().length > 0">
                                <table class="table table-striped table-bordered table-condensed">
                                    <thade>
                                        <tr>
                                            <td>知识点名称</td>
                                            <td>知识点类型</td>
                                            <td>操作</td>
                                        </tr>
                                    </thade>
                                    <tbody data-bind="foreach: points">
                                        <tr>
                                            <td data-bind="text: content"></td>
                                            <td>
                                                <label class="control-label">
                                                    <input type="checkbox" data-bind="checked: isKeyPoint">
                                                    主知识点
                                                </label>
                                            </td>
                                            <td class="col-sm-3">
                                                <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                                            </th>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="row">
                                <div class="col-sm-5">
                                    <input type="text" class="treeDialog form-control">
                                </div>
                                <div class="col-sm-5">
                                    <label class="radio-inline">
                                        <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                                        设为主知识点
                                    </label>
                                </div>
                                <div class="col-sm-2">
                                    <button class="btn btn-primary" data-bind="click: add_option_point">新增考点</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">分值:</label>
                        <div class="col-sm-8">
                            <input class="form-control" data-bind="value: score" placeholder="请输入分值系数（整数）">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

<!--主观题答案-->
{% macro subjective_answer() %}
<div class="form-group">
    <label class="col-sm-2 control-label">正确答案: </label>
    <!-- ko foreach: answers -->
    <div class="col-sm-10">
        <script id="answer_content" type="text/plain"></script>
    </div>
    <div class="form-group"></div>
    <div class="form-group">
        <label class="col-sm-2 control-label">知识点：</label>
        <div class="col-sm-8">
            <div class="form-group" style="margin: 0 10px;width: 100%;" data-bind="if: points().length > 0, visible: points().length > 0">
                <table class="table table-striped table-bordered table-condensed">
                    <thade>
                        <tr>
                            <td>知识点名称</td>
                            <td>知识点类型</td>
                            <td>操作</td>
                        </tr>
                    </thade>
                    <tbody data-bind="foreach: points">
                        <tr>
                            <td data-bind="text: content"></td>
                            <td>
                                <label class="control-label">
                                    <input type="checkbox" data-bind="checked: isKeyPoint">
                                    主知识点
                                </label>
                            </td>
                            <td class="col-sm-3">
                                <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                            </th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="row">
                <div class="col-sm-5">
                    <input type="text" class="treeDialog form-control">
                </div>
                <div class="col-sm-5">
                    <label class="radio-inline">
                        <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                        设为主知识点
                    </label>
                </div>
                <div class="col-sm-2">
                    <button class="btn btn-primary" data-bind="click: add_option_point">新增考点</button>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label">分值:</label>
        <div class="col-sm-8">
            <input class="form-control" data-bind="value: score" placeholder="请输入分值系数（整数）">
        </div>
    </div>
    <!-- /ko -->
</div>
{% endmacro %}

<!--选词填空题答案-->
{% macro choice_block_answer() %}
<div class="form-group">
    <label class="col-sm-2 control-label">正确答案: </label>
    <!-- ko if: answers().length == 0 -->
    <div class="col-sm-10" style="font: 16px/20px sans-serif;">请在题干输入内容，填空部分用 __$$__  标示</div>
    <!-- /ko -->
    <div class="col-sm-10 answer_nlgs" data-bind="foreach: answers">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-sm-2" data-bind="text: '第 ' + ($index() + 1) + ' 空'"></label>
                </div>
                <div class="form-group">
                    <span class="col-sm-1">&nbsp;</span>
                    <!-- ko foreach: $parent.options -->
                        <label class="radio-inline col-sm-1">
                            <input type="radio" data-bind="value: id, checked: $parent.content, attr: {name: 'blockchoice_answer_'+$parentContext.$index()}">
                            <!-- ko text: id --><!-- /ko -->
                        </label>
                    <!-- /ko -->
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">知识点:</label>
                <div class="col-sm-8">
                    <div class="form-group" data-bind="if: points().length > 0, visible: points().length > 0">
                        <table class="table table-striped table-bordered table-condensed">
                            <thade>
                                <tr>
                                    <td>知识点名称</td>
                                    <td>知识点类型</td>
                                    <td>操作</td>
                                </tr>
                            </thade>
                            <tbody data-bind="foreach: points">
                                <tr>
                                    <td data-bind="text: content"></td>
                                    <td>
                                        <label class="control-label">
                                            <input type="checkbox" data-bind="checked: isKeyPoint">
                                            主知识点
                                        </label>
                                    </td>
                                    <td class="col-sm-3">
                                        <a href="javascript:void(0);" data-bind="click: function(){ $parent.points.remove(this); }">删除</a>
                                    </th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-5">
                            <input type="text" class="treeDialog form-control">
                        </div>
                        <div class="col-sm-5">
                            <label class="radio-inline">
                                <input type="checkbox" data-bind="checked: _search_point_type" placeholder="请点击选择知识点">
                                设为主知识点
                            </label>
                        </div>
                        <div class="col-sm-2">
                            <button class="btn btn-primary" data-bind="click: add_option_point">新增考点</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label">分值:</label>
                <div class="col-sm-8">
                    <input class="form-control" data-bind="value: score" placeholder="请输入分值系数（整数）">
                </div>
            </div>
        </div>
    </div>
</div>
{% endmacro %}


<!-- 题目信息结束标志 -->
{% macro content_end() %}
    </div>
</div>
{% endmacro %}

<!-- 解析 -->
{% macro analysis() %}
<div class="panel panel-info">
    <div class="panel-heading">题目解析</div>
    <div class="panel-body">
        <!-- ko ifnot: different -->
        <div class="form-group">
            <label class="col-sm-2 control-label">解析:</label>
            <div class="col-sm-10">
                <script data-bind="attr: { id: analysis_editor_code }" name="analysis_editor_code" type="text/plain"></script>
            </div>
        </div>
        <!-- /ko -->

        <!-- ko if: different -->
            <!-- ko foreach: keychain -->
                <!-- ko switch: type -->
                <!-- ko case: 1 -->
                <div class="form-group">
                    <label class="col-sm-2 control-label" data-bind="text: name + ':'"></label>
                    <div class="col-sm-10">
                        <script data-bind="attr: { id: key + $parent.setRandomCode(), name: 'analysis_types_editor_code', 'data-chain-id': $index() }" type="text/plain"></script>
                    </div>
                </div>
                <!-- /ko -->
                <!-- ko case: 2 -->
                <div class="form-group">
                    <label class="col-sm-2 control-label" data-bind="text: name + ':'"></label>
                    <div class="col-sm-10">
                        <input type="text" class="localTreeDialog form-control" data-bind="attr: { 'data-id': key, 'data-chain-id': $index(), 'data-multi': multi }">
                    </div>
                </div>
                <!-- /ko -->
                <!-- ko case: 3 -->
                <!-- /ko -->
                <!-- /ko -->
            <!-- /ko -->
        <!-- /ko -->
    </div>
</div>
{% endmacro %}

<!-- 提交按钮 -->
{% macro submit() %}
<div class="form-group" style="margin:80px 0">
    <label class="col-sm-2 control-label">&nbsp;</label>
    <div class="col-sm-3" data-bind="if: id() == '', visible: id() == ''">
        <button class="btn btn-block btn-primary" data-bind="click: function(){ submit(question, 1); }, disable: submit_disable">保存并录下一题</button>
    </div>
    <div class="col-sm-3" data-bind="if: id() == '', visible: id() == ''">
        <button class="btn btn-block btn-primary" data-bind="click: function(){ submit(question); }, disable: submit_disable">保存并退出</button>
    </div>
    <div class="col-sm-3" data-bind="if: id() != '', visible: id() != ''">
        <button class="btn btn-block btn-primary" data-bind="click: function(){ submit(question); }, disable: submit_disable">确定</button>
    </div>
    <div class="col-sm-3">
        <button class="btn btn-block" data-bind="click: function(){ window.close(); }">取消</button>
    </div>
</div>
{% endmacro %}

<!-- 复合题提交按钮 -->
{% macro complex_submit() %}
<div class="form-group" style="margin:80px 0">
    <label class="col-sm-2 control-label">&nbsp;</label>
    <div class="col-sm-3" data-bind="if: id() == '', visible: id() == ''">
        <button class="btn btn-block btn-primary" data-bind="click: function(){ submit(question); }, disable: submit_disable">保存并增加子题目</button>
    </div>
    <div class="col-sm-3" data-bind="if: id() != '', visible: id() != ''">
        <button class="btn btn-block btn-primary" data-bind="click: function(){ submit(question, 2); }, disable: submit_disable">确定</button>
    </div>
    <div class="col-sm-3">
        <button class="btn btn-block" data-bind="click: function(){ window.close(); }">取消</button>
    </div>
    <div class="col-sm-3" data-bind="if: id() == '', visible: id() == ''">
        <button class="btn btn-block btn-primary" data-bind="click: function(){ submit(question, 1); }, disable: submit_disable">保存并录下一题</button>
    </div>
</div>
{% endmacro %}

<!-- 预览界面 -->
{% macro review(content_type, from) %}
<div class="previewarea col-sm-4">
    <div class="panel panel-info">
        <!-- <div class="panel-heading">题目预览</div> -->
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a id="questiondata-tab" href="#questiondata" aria-controls="questiondata" role="tab" data-toggle="tab" aria-expanded="false">试题数据</a></li>
            <li role="presentation"><a id="mobilepreview-tab" href="#mobilepreview" aria-controls="mobilepreview" role="tab" data-toggle="tab" aria-expanded="true" data-bind="click: mobilePreview">手机预览</a></li>
            <li role="presentation"><a id="pcpreview-tab" target="_blank" aria-expanded="false" data-bind="click: pcPreview.bind($data, id())">PC预览</a></li>
        </ul>

        <div class="tab-content">
            <div role="tabpanel" class="tab-pane pre" id="mobilepreview" aria-labelledby="mobilepreview-tab">
                <iframe id="previewiframe" data-bind="attr: {'data-src': '{{ g.subject_id }}' >= 200 ? 'http://www.17xueshe.com/qbank/qPreviewMobile?question_id='+id() : '/xx/questions/preview-mobile?question_id='+id()}" width="320" height="640" frameborder="0"></iframe>
                <button class="btn btn-primary pa" style="top:10px;right:10px;" data-bind="click: refreshPreview.bind($data, question)">刷新</button>
            </div>
            <!-- <div role="tabpanel" class="tab-pane" id="pcpreview" aria-labelledby="pcpreview-tab"></div> -->
            <div role="tabpanel" class="tab-pane active" id="questiondata" aria-labelledby="questiondata-tab" style="max-height:640px;overflow:auto;">
                <label>题型:</label>
                <div class="alert alert-warning">
                    <div><span>题目题型</span>: <span data-bind="text: content_type_name"></span></div>
                    <div><span>一级题型</span>: <span data-bind="text: second_content_type_name"></span></div>
                    <div><span>二级题型</span>: <span data-bind="text: third_content_type_name"></span></div>
                </div>

                <!-- 判断是不是复合题子题 -->
                <!-- ko if: '{{ from }}' != 'from_complex_sub' -->

                <label>所属试卷:</label>
                <div class="alert alert-warning">
                    <!-- ko foreach: papers -->
                    <div><span data-bind="text: content"></span> - <span data-bind="text: '第 ' + number() + ' 题'"></span></div>
                    <!-- /ko -->
                </div>

                <label>题目知识点:</label>
                <div class="alert alert-warning">
                    <!-- ko foreach: points -->
                    <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                    <!-- /ko -->
                </div>

                <label>题目难度:</label>
                <div class="alert alert-warning" data-bind="text: difficulty_name"></div>

                <!-- 前端是否显示 -->
                {% if g.subject_id|int > 199 %}
                <label>前端是否显示:</label>
                <div class="alert alert-warning" data-bind="text: question_type() == 0 ? '不显示' : '显示'"></div>
                {% endif %}

                <!-- ko if: typeof seconds != 'undefined' -->
                <label>作答时间</label>
                <div class="alert alert-warning" data-bind="text: seconds"></div>
                <!-- /ko -->

                <!-- /判断是否是复合题子题 -->
                <!-- /ko -->

                <!-- ko if: '{{ from }}' == 'from_complex_sub' -->
                <label>子题目类型:</label>
                <div class="alert alert-warning" data-bind="text: sub_content_type_name"></div>
                <!-- /ko -->

                <!-- ko if: has_listen -->
                <label>听力材料:</label>
                <div class="alert alert-warning">
                    <!-- ko foreach: resources -->
                    <div><span data-bind="text: name"></span></div>
                    <!-- /ko -->
                </div>
                <!-- /ko -->

                <!-- ko if: description().length > 0 -->
                <label>作答说明:</label>
                <div class="alert alert-warning">
                    <div><span data-bind="text: description"></span></div>
                </div>
                <!-- /ko -->

                <!-- ko if: '{{content_type}}' == 11 || '{{content_type}}' == 12 -->
                <label>作答时间:</label>
                <div class="alert alert-warning" data-bind="text: seconds() ? seconds() + '秒' : ''"></div>
                <!-- /ko -->

                <label>题干:</label>
                <!-- ko if: ['11', '12', '13', '14', '15'].indexOf('{{content_type}}') > -1 -->
                <div class="alert alert-warning content_preview">
                    <img data-bind="attr: { src: pic_url }" style="max-width: 300px; max-height: 300px;" alt=""/>
                </div>
                <!-- /ko -->
                <div class="alert alert-warning content_preview" data-bind="html: content"></div>

            <!-- ko if: '{{ content_type }}' == 12 -->
            <label>voice_text:</label>
            <div class="alert alert-warning content_preview" data-bind="text: voice_text"></div>
            <!-- /ko -->

            <!-- ko if: '{{ content_type }}' == 15 -->
            <label>变量:</label>
            <div class="alert alert-warning content_preview">
                <!-- ko foreach: variables -->
                <div><span data-bind="text: content"></span></div>
                <!-- /ko -->
            </div>
            <label>句式:</label>
            <div class="alert alert-warning content_preview">
                <!-- ko foreach: sentence_patterns -->
                <div><span data-bind="text: content"></span></div>
                <!-- /ko -->
            </div>
            <label>关键字:</label>
            <div class="alert alert-warning content_preview">
                <!-- ko foreach: keywords -->
                <div><span data-bind="text: content"></span></div>
                <!-- /ko -->
            </div>
            <!-- /ko -->

            <!-- 判断是不是复合题 -->
            <!-- ko if: '{{content_type}}' != 'complex' -->

                <!-- ko if: '{{content_type}}' != 12 && '{{content_type}}' != 13 && '{{content_type}}' != 15 -->
                <label>不显示选项序号:</label>
                <div class="alert alert-warning" data-bind="text: hide_option_number() ? '是' : '否'"></div>
                <!-- /ko -->

                <!-- ko if: '{{content_type}}' != 12 && '{{content_type}}' != 15 -->
                <label data-bind="text: '{{content_type}}' != 14 ? '选项:' : '跟读内容:'"></label>
                <div class="alert alert-warning">
                    <!-- ko switch: '{{content_type}}' -->
                        <!-- ko case: 7 -->
                            <!-- ko foreach: options -->
                            <div><span data-bind="text: id()+1"></span>: <span data-bind="html: content" class="clearfix"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 8 -->
                            <!-- ko foreach: options -->
                            <div><span data-bind="text: id()+1"></span>: <span data-bind="html: content" class="clearfix"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 9 -->
                            <!-- ko foreach: options -->
                            <div><span data-bind="text: id()+1"></span>: <span data-bind="html: content" class="clearfix"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 11 -->
                            <!-- ko foreach: options -->
                                <div><span data-bind="text: id()"></span>: </div>
                                <div><span data-bind="text: '显示内容'"></span>: <span data-bind="text: content"></span></div>
                                <!-- ko foreach: voice_texts -->
                                <div><span data-bind="text: 'Voice text'"></span>: <span data-bind="text: content"></span></div>
                                <!-- /ko -->
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 12 -->
                            <!-- ko foreach: options -->
                            <div><span data-bind="text: '句式'"></span>: <span data-bind="text: content"></span></div>
                            <div><span data-bind="text: '内容'"></span>: <span data-bind="text: voice_text"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 13 -->
                            <!-- ko foreach: roles -->
                                <!-- ko if: role_type() == 1 -->
                                    <div><span data-bind="text: '作答角色'"></span>: </div>
                                    <div><span data-bind="text: '角色名称'"></span>: <span data-bind="text: name"></span></div>
                                    <div><span data-bind="text: '显示内容'"></span>: <span data-bind="text: content"></span></div>
                                    <!-- ko foreach: voice_texts -->
                                    <div><span data-bind="text: 'Voice text'"></span>: <span data-bind="text: content"></span></div>
                                    <!-- /ko -->
                                    <div><span data-bind="text: '作答时间'"></span>: <span data-bind="text: seconds() ? seconds() + '秒' : ''"></span></div>
                                <!-- /ko -->
                                <!-- ko if: role_type() == 2 -->
                                    <div><span data-bind="text: '非作答角色'"></span>: </div>
                                    <div><span data-bind="text: '角色名称'"></span>: <span data-bind="text: name"></span></div>
                                    <div><span data-bind="text: '显示内容'"></span>: <span data-bind="text: content"></span></div>
                                    <div data-bind="if: resource.name().length > 0">
                                        <div data-bind="text: resource.name"></div>
                                        <div style="width: 50px;">
                                            <audio preload="none" data-bind="attr: { src: resource.url }" controls></audio>
                                        </div>
                                    </div>
                                <!-- /ko -->
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 14 -->
                            <!-- ko foreach: roles -->
                                <!-- ko if: role_type() == 1 -->
                                    <div><span data-bind="text: '作答角色'"></span>: </div>
                                    <div><span data-bind="text: '角色名称'"></span>: <span data-bind="text: name"></span></div>
                                    <div><span data-bind="text: '显示内容'"></span>: <span data-bind="text: content"></span></div>
                                    <div><span data-bind="text: 'Voice text'"></span>: <span data-bind="text: voice_text"></span></div>
                                    <div><span data-bind="text: '作答时间'"></span>: <span data-bind="text: seconds() ? seconds() + '秒' : ''"></span></div>
                                    <div data-bind="if: resource.name().length > 0">
                                        <div data-bind="text: resource.name"></div>
                                        <div style="width: 50px;">
                                            <audio preload="none" data-bind="attr: { src: resource.url }" controls></audio>
                                        </div>
                                    </div>
                                    <br/>
                                <!-- /ko -->
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: $default -->
                            <!-- ko foreach: options -->
                            <div><span data-bind="text: id"></span>: <span data-bind="html: content" class="clearfix"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                    <!-- /ko -->
                </div>
                <!-- /ko -->

                <!-- ko if: '{{content_type}}' != 12 && '{{content_type}}' != 13 && '{{content_type}}' != 14 && '{{content_type}}' != 15 -->
                <label>正确答案:</label>
                <div class="alert alert-warning">
                    <!-- ko switch: '{{content_type}}' -->
                        <!-- ko case: 4 -->
                            <!-- ko foreach: answers -->
                                <div><span data-bind="text: '第'+($index()+1)+'空'"></span>：<span data-bind="html: content"></span></div>
                                <!-- ko foreach: points -->
                                <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                                <!-- /ko -->
                                <div><span data-bind="text: '分值： ' + score()"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 6 -->
                            <!-- ko foreach: answers -->
                                <div data-bind="html: content"></div>
                                <!-- ko foreach: points -->
                                <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                                <!-- /ko -->
                                <div><span data-bind="text: '分值： ' + score()"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 7 -->
                            <!-- ko foreach: answers -->
                                <div><span data-bind="text: id()+1"></span>：<span data-bind="html: content"></span></div>
                                <!-- ko foreach: points -->
                                <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                                <!-- /ko -->
                                <div><span data-bind="text: '分值： ' + score()"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 8 -->
                            <!-- ko foreach: answers -->
                                <div><span data-bind="text: id()+1"></span>：<span data-bind="html: content"></span><b data-bind="text: classify_name"></b></div>
                                <!-- ko foreach: points -->
                                <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                                <!-- /ko -->
                                <div><span data-bind="text: '分值： ' + score()"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 9 -->
                            <!-- ko foreach: answers -->
                                <div data-bind="html: content"></div>
                                <!-- ko foreach: points -->
                                <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                                <!-- /ko -->
                                <div><span data-bind="text: '分值： ' + score()"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: 10 -->
                            <!-- ko foreach: answers -->
                                <div><span data-bind="text: '第'+($index()+1)+'空'"></span>：<span data-bind="html: content"></span></div>
                                <!-- ko foreach: points -->
                                <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                                <!-- /ko -->
                                <div><span data-bind="text: '分值： ' + score()"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                        <!-- ko case: $default -->
                            <!-- ko foreach: answers -->
                                <div><span data-bind="text: id"></span></div>
                                <!-- ko foreach: points -->
                                <div><span data-bind="text: content"></span><span data-bind="text: isKeyPoint() ? ' - 主知识点' : ''"></span></div>
                                <!-- /ko -->
                                <div><span data-bind="text: '分值： ' + score(), visible: !$parent.answer_is_radio()"></span></div>
                            <!-- /ko -->
                        <!-- /ko -->
                    <!-- /ko -->
                </div>
                <!-- /ko -->

                <!-- ko ifnot: different() -->
                <label>解析：</label>
                <div class="alert alert-warning">
                    <div data-bind="html: analysis"></div>
                </div>
                <!-- /ko -->
                <!-- ko if: different() -->
                <!-- ko foreach: keychain -->
                <label data-bind="text: name + '：'"></label>
                    <!-- ko switch: type -->
                        <!-- ko case: 1 -->
                        <div class="alert alert-warning">
                            <div data-bind="html: content"></div>
                        </div>
                        <!-- /ko -->
                        <!-- ko case: 2 -->
                        <div class="alert alert-warning">
                            <!-- ko foreach: choice -->
                            <div data-bind="text: text"></div>
                            <!-- /ko -->
                        </div>
                        <!-- /ko -->
                    <!-- /ko -->
                <!-- /ko -->
                <!-- /ko -->

                <!-- /判断是不是复合题 -->
                <!-- /ko -->
            </div>
        </div>

        
    </div>
</div>
{% endmacro %}

{% macro check_repeat(content_type, resource_type) %}
{% if content_type!=-1 %}
<!-- ko if: typeof question=='undefined' || question.resource_ids.length == 0 -->
<button class="btn btn-lg btn-success checkrepeatbtn" data-bind="click: checkDuplicate.bind($data, '{{resource_type}}')"><i class="glyphicon glyphicon-eye-open mr_10"></i>判断相似题</button>
<!-- /ko -->
{% endif %}
{% endmacro %}


<!-- 听力上传代码 -->
{% macro upload_source() %}
    var url = "/xx/files/upload";
    $("#fileupload").fileupload({
        url: url,
        dataType: 'json',
        maxChunkSize: null,
        formData: {
            upload: "upload"
        },
        singleFileUploads: true,
        done: function (e, data) {
            //多音频上传（谁知道将来加不加呢...）
//                viewModel.resources.push(new Resource({
//                    id  : data.result.file_id,
//                    name: data.result.filename,
//                    url : data.result.url
//                }));
            // 临时方案，cdn的url需要先请求一下，否则报416错误
            var load_img = new Image();
            load_img.src = data.result.url;
            load_img.onload=load_img.onerror=function(){
                viewModel.resources([new Resource({
                    id  : data.result.file_id,
                    name: data.result.filename,
                    url : data.result.url
                })]);

                $('#progress .progress-bar').css('width', '0%');
            }
        },
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#progress .progress-bar').css('width', progress + '%');
        }
    }).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');
{% endmacro %}

<!-- 口语图片上传代码 -->
{% macro oral_img_upload_source() %}
    var url = "/xx/files/upload";
    $("#imgupload").fileupload({
        url: url,
        dataType: 'json',
        maxChunkSize: null,
        formData: {
            upload: "upload"
        },
        singleFileUploads: true,
        done: function (e, data) {
            viewModel.pic_url(data.result.url);
            viewModel.pic_name(data.result.filename);

            $('#imgprogress .progress-bar').css('width', '0%');
        },
        progressall: function (e, data) {
            var progress = parseInt(data.loaded / data.total * 100, 10);
            $('#imgprogress .progress-bar').css('width', progress + '%');
        }
    }).prop('disabled', !$.support.fileInput).parent().addClass($.support.fileInput ? undefined : 'disabled');
{% endmacro %}

<!-- 初始化知识点树插件 -->
{% macro point_tree() %}
$('.treeDialog').each(function(index){
    if(index == 0){
        TreeDialogMod.init({
            inputs          : $(this),
            bindInput       : $(this),
            getChildrenUrl  : '/xx/knowledge/get-children',
            getAllPointsUrl : '/xx/knowledge/get-all-points/',
            subjectId       : question.subject_id,
            maxTags         : 1
        });
    }else{
        TreeDialogMod.bindInput($(this));
    }
});

$('.localTreeDialog').each(function(index){
    var $this = $(this);
    var id = $this.attr("data-id");
    var data = [];
    var analysis_types = [];
    if(typeof question.analysis_types != 'undefined'){
        analysis_types = [].concat(question.analysis_types);
    }else if(typeof sub_content != 'undefined' && typeof sub_content.analysis_types != 'undefined'){
        analysis_types = [].concat(sub_content.analysis_types);
    }

    for(var i = 0; i < analysis_types.length; i++){
        if(id == analysis_types[i]._id){
            data = analysis_types[i].choices;
        }
    }

    function tagsChange(){
        var tags = xxx.getTags();
        viewModel.keychain()[$this.attr("data-chain-id")].choice.removeAll();
        for(var i = 0; i < tags.length; i++){
            viewModel.keychain()[$this.attr("data-chain-id")].choice.push({
                id      : ko.observable(tags[i].id),
                text    : ko.observable(tags[i].text)
            });
        }
        return true;
    }

    var xxx = new LocalTreeDialog({
        inputs          : $this,
        bindInput       : $this,
        data            : data,
        maxTags         : $this.attr("data-multi") == '1' ? 0 : 1,
        tagsChange      : tagsChange,
        afterAddTag     : tagsChange
    });

    if(viewModel.keychain()[$this.attr("data-chain-id")].choice().length > 0){
        var choice = [].concat(viewModel.keychain()[$this.attr("data-chain-id")].choice());
        for(var i = 0; i < choice.length; i++){
            xxx.addTag(choice[i].id(), choice[i].text());
        }
    }
});
{% endmacro %}
